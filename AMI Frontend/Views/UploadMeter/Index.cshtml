@{
    ViewBag.Title = "Upload Meters";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold">Upload Meter Data</h4>
    </div>

    <div class="card shadow-sm border-0 rounded-4 p-4">
        <form id="uploadForm" enctype="multipart/form-data">
            <div class="mb-3">
                <label for="meterFile" class="form-label">Select Excel/CSV File</label>
                <input type="file" class="form-control" id="meterFile" accept=".xlsx,.csv" required>
            </div>
            <button type="submit" class="btn btn-success">Upload</button>
        </form>

        <div id="uploadStatus" class="mt-3 text-muted"></div>
    </div>
</div>

<script>
    $("#uploadForm").submit(function (e) {
        e.preventDefault();
        const fileInput = $("#meterFile")[0].files[0];
        if (!fileInput) return;

        const formData = new FormData();
        formData.append("file", fileInput);

        $("#uploadStatus").text("Uploading...");

        $.ajax({
            url: "/api/meters/upload",
            type: "POST",
            headers: { "Authorization": "Bearer " + localStorage.getItem("jwtToken") },
            data: formData,
            processData: false,
            contentType: false,
            success: function () {
                $("#uploadStatus").text("✅ Upload successful!");
            },
            error: function () {
                $("#uploadStatus").text("❌ Upload failed. Please try again.");
            }
        });
    });
</script>
